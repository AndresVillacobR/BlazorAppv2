@page "/panel"
@rendermode InteractiveServer

<PageTitle>Panel de Control</PageTitle>

<div class="container mt-4">
    <h1>Panel de Control - Sistema de Riego</h1>

    <!-- Tabla de registros -->
    <div class="card table-card">
        <div class="card-body">
            <h4 class="mb-3">Historial de Lecturas</h4>
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Humedad (%)</th>
                        <th>Temperatura (°C)</th>
                        <th>Estado de Riego</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var registro in registros)
                    {
                        <tr>
                            <td>@registro.Fecha.ToString("dd/MM/yyyy")</td>
                            <td>@registro.Fecha.ToString("HH:mm:ss")</td>
                            <td>@registro.Humedad</td>
                            <td>@registro.Temperatura</td>
                            <td>@(registro.RiegoActivo ? "Activo" : "Inactivo")</td>
                        </tr>
                    }
                </tbody>
            </table>

            <button class="btn btn-primary mt-3" @onclick="GenerarLectura">
                Registrar Nueva Lectura
            </button>
        </div>
    </div>
</div>

@code {
    private List<RegistroRiego> registros = new();

    protected override void OnInitialized()
    {
        // Datos iniciales de ejemplo
        registros.Add(new RegistroRiego { Fecha = DateTime.Now.AddMinutes(-30), Humedad = 60, Temperatura = 23, RiegoActivo = false });
        registros.Add(new RegistroRiego { Fecha = DateTime.Now.AddMinutes(-20), Humedad = 55, Temperatura = 24, RiegoActivo = true });
        registros.Add(new RegistroRiego { Fecha = DateTime.Now.AddMinutes(-10), Humedad = 58, Temperatura = 25, RiegoActivo = false });
    }

    private void GenerarLectura()
    {
        var random = new Random();
        registros.Insert(0, new RegistroRiego
        {
            Fecha = DateTime.Now,
            Humedad = random.Next(40, 70),
            Temperatura = random.Next(20, 30),
            RiegoActivo = random.Next(0, 2) == 1
        });
    }

    public class RegistroRiego
    {
        public DateTime Fecha { get; set; }
        public int Humedad { get; set; }
        public int Temperatura { get; set; }
        public bool RiegoActivo { get; set; }
    }
}
